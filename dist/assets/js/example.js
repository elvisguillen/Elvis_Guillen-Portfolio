var getPrefixedCssProp=function(e){var t=Modernizr.prefixed(e);return t=t.replace(/([A-Z])/g,function(e,t){return"-"+t.toLowerCase()}).replace(/^ms-/,"-ms-"),t},PanningRegion=Marionette.Region.extend({initialize:function(){var e={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd",msTransition:"MSTransitionEnd",transition:"transitionend"};this.transEndEventName=e[Modernizr.prefixed("transition")],this.transformPropName=getPrefixedCssProp("transform"),console.log(this.transEndEventName,this.transformPropName)},transitionToView:function(e,t){var n=this,r=this.currentView;if(!r||r.isClosed){this.show(e);return}Marionette.triggerMethod.call(this,"willTransition",r),this.stopListening(e,"render"),this.listenTo(e,"render",function(){n.$el.off(n.transEndEventName);var r;t==="slide"?r="translateX(100%)":t==="rotate"?r="translateX(100%) translateY(100%) rotate("+["20","40","60","80","90"][_.random(0,4)]+"deg)":t==="drop"&&(r="translateY(100%)"),e.$el.css(n.transformPropName,r),n.$el.append(e.el);var i=jQuery("#world-bg"),s=Matrix.initWithElem(n.$el),o=Matrix.initWithElem(i),u=Matrix.initWithElem(e.$el);n.$el.addClass("animated"),i.addClass("animated"),n.$el.css(n.transformPropName,u.clone().invert().toMatrixString()),i.css(n.transformPropName,u.clone().invert().toMatrixString()),n.$el.on(n.transEndEventName,function(){n.$el.off(n.transEndEventName),n.close(),n.currentView=e,n.$el.removeClass("animated"),i.removeClass("animated"),n.$el.css(n.transformPropName,(new Matrix).toMatrixString()),e.$el.css(n.transformPropName,(new Matrix).toMatrixString()),i.css("webkit-transform",(new Matrix).toMatrixString()),Marionette.triggerMethod.call(e,"show"),Marionette.triggerMethod.call(n,"show",e)})}),e.render()}}),images=["http://www.beebeography.com/gallery/albums/photo-a-day/shot_1280681268477.jpg","http://www.beebeography.com/gallery/albums/photo-a-day/shot_1280680963306.jpg","http://www.beebeography.com/gallery/albums/photo-a-day/shot_1276450432475.jpg","http://www.beebeography.com/gallery/albums/photo-a-day/shot_1280589206524.jpg","http://www.beebeography.com/gallery/albums/photo-a-day/shot_1281316893984.jpg","http://www.beebeography.com/gallery/albums/photo-a-day/shot_1281750661825.jpg","http://www.beebeography.com/gallery/albums/photo-a-day/shot_1281836985948.jpg","http://www.beebeography.com/gallery/albums/photo-a-day/shot_1282279187455.jpg","http://www.beebeography.com/gallery/albums/photo-a-day/shot_1282420737791.jpg"],App=new Marionette.Application;App.addRegions({worldContent:{selector:"#world-content",regionType:PanningRegion}}),App.module("SampleModule",function(e,t,n,r,i,s){var o=n.Model.extend(),u=r.ItemView.extend({template:"#slideTemplate",events:{"click button.next-slide":"slide","click button.next-rotate":"rotate","click button.next-drop":"drop"},slide:function(){this.trigger("next","slide")},rotate:function(){this.trigger("next","rotate")},drop:function(){this.trigger("next","drop")}}),a=r.Controller.extend({initialize:function(e){this.region=e.region},show:function(e){var t=new o({title:"Panning Region",subtitle:"Powered by MarionetteJS",image:images[s.random(0,images.length-1)]}),n=new u({model:t});this.region.transitionToView(n,e),this.listenTo(n,"next",function(e){this.show(e)})}});e.addInitializer(function(){e.controller=new a({region:t.worldContent}),e.controller.show()})}),App.start();